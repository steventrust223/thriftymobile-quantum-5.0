<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Add New Phone</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #333;
      padding: 20px;
      line-height: 1.6;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
      background: white;
      border-radius: 16px;
      padding: 32px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
    }

    .header {
      text-align: center;
      margin-bottom: 32px;
    }

    .header h1 {
      font-size: 24px;
      color: #667eea;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
    }

    .header p {
      color: #666;
      font-size: 14px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
      color: #333;
      font-size: 14px;
    }

    .form-group label .required {
      color: #ef4444;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-size: 14px;
      font-family: inherit;
      transition: border-color 0.2s;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #667eea;
    }

    .form-group textarea {
      resize: vertical;
      min-height: 80px;
    }

    .form-group .hint {
      font-size: 12px;
      color: #999;
      margin-top: 4px;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    .button-group {
      display: flex;
      gap: 12px;
      margin-top: 32px;
      padding-top: 24px;
      border-top: 1px solid #e5e7eb;
    }

    .btn {
      flex: 1;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 14px 24px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .btn.secondary {
      background: white;
      color: #667eea;
      border: 2px solid #e5e7eb;
      box-shadow: none;
    }

    .btn.secondary:hover {
      background: #f9fafb;
      border-color: #667eea;
    }

    .success-message {
      display: none;
      background: #d1fae5;
      color: #065f46;
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 20px;
      text-align: center;
      font-weight: 600;
    }

    .error-message {
      display: none;
      background: #fee2e2;
      color: #991b1b;
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 20px;
      text-align: center;
      font-weight: 600;
    }

    @media (max-width: 600px) {
      .form-row {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1><span>➕</span> Add New Phone</h1>
      <p>Add a new phone to your inventory</p>
    </div>

    <div class="success-message" id="successMessage">
      ✅ Phone added successfully!
    </div>

    <div class="error-message" id="errorMessage">
      ❌ Error: <span id="errorText"></span>
    </div>

    <form id="addPhoneForm">
      <div class="form-group">
        <label>Phone Model <span class="required">*</span></label>
        <input type="text" id="model" name="model" required placeholder="e.g., iPhone 14 Pro Max">
        <div class="hint">Enter the full phone model name</div>
      </div>

      <div class="form-group">
        <label>IMEI <span class="required">*</span></label>
        <input type="text" id="imei" name="imei" required placeholder="15 digits" pattern="[0-9]{15}" maxlength="15">
        <div class="hint">15-digit IMEI number</div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Condition <span class="required">*</span></label>
          <select id="condition" name="condition" required>
            <option value="">Select condition</option>
            <option value="Like New">Like New</option>
            <option value="Excellent">Excellent</option>
            <option value="Good">Good</option>
            <option value="Fair">Fair</option>
            <option value="Poor">Poor</option>
          </select>
        </div>

        <div class="form-group">
          <label>Storage <span class="required">*</span></label>
          <select id="storage" name="storage" required>
            <option value="">Select storage</option>
            <option value="64GB">64GB</option>
            <option value="128GB">128GB</option>
            <option value="256GB">256GB</option>
            <option value="512GB">512GB</option>
            <option value="1TB">1TB</option>
          </select>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Purchase Price <span class="required">*</span></label>
          <input type="number" id="purchasePrice" name="purchasePrice" required min="0" step="0.01" placeholder="0.00">
          <div class="hint">Amount paid for the device</div>
        </div>

        <div class="form-group">
          <label>Status</label>
          <select id="status" name="status">
            <option value="In Stock">In Stock</option>
            <option value="Listed">Listed</option>
            <option value="Pending">Pending</option>
            <option value="Sold">Sold</option>
            <option value="Defective">Defective</option>
          </select>
        </div>
      </div>

      <div class="form-group">
        <label>Notes</label>
        <textarea id="notes" name="notes" placeholder="Any additional notes about this device..."></textarea>
      </div>

      <div class="button-group">
        <button type="button" class="btn secondary" onclick="google.script.host.close()">Cancel</button>
        <button type="submit" class="btn" id="submitBtn">Add Phone</button>
      </div>
    </form>
  </div>

  <script>
    document.getElementById('addPhoneForm').addEventListener('submit', function(e) {
      e.preventDefault();

      // Disable submit button
      const submitBtn = document.getElementById('submitBtn');
      submitBtn.disabled = true;
      submitBtn.textContent = 'Adding...';

      // Hide messages
      document.getElementById('successMessage').style.display = 'none';
      document.getElementById('errorMessage').style.display = 'none';

      // Collect form data
      const phoneData = {
        model: document.getElementById('model').value,
        imei: document.getElementById('imei').value,
        condition: document.getElementById('condition').value,
        storage: document.getElementById('storage').value,
        purchasePrice: parseFloat(document.getElementById('purchasePrice').value),
        status: document.getElementById('status').value,
        notes: document.getElementById('notes').value
      };

      // Call Google Apps Script function
      google.script.run
        .withSuccessHandler(onSuccess)
        .withFailureHandler(onError)
        .addPhone(phoneData);
    });

    function onSuccess(result) {
      const submitBtn = document.getElementById('submitBtn');
      submitBtn.disabled = false;
      submitBtn.textContent = 'Add Phone';

      if (result.success) {
        // Show success message
        document.getElementById('successMessage').style.display = 'block';

        // Reset form
        document.getElementById('addPhoneForm').reset();

        // Auto-close after 2 seconds
        setTimeout(function() {
          google.script.host.close();
        }, 2000);
      } else {
        // Show error message
        document.getElementById('errorText').textContent = result.message;
        document.getElementById('errorMessage').style.display = 'block';
      }
    }

    function onError(error) {
      const submitBtn = document.getElementById('submitBtn');
      submitBtn.disabled = false;
      submitBtn.textContent = 'Add Phone';

      // Show error message
      document.getElementById('errorText').textContent = error;
      document.getElementById('errorMessage').style.display = 'block';
    }
  </script>
</body>
</html>
